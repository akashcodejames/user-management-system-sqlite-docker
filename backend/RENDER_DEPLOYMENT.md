# ğŸš€ Backend Deployment Guide - GitHub to Render

This guide will walk you through deploying your Flask backend to Render via GitHub.

---

## âœ… Backend is Ready!

I've prepared your backend with:
- âœ… Created [generate_secret_key.py](file:///Users/akashyadav/Desktop/intern/backend/generate_secret_key.py) - Secure key generator
- âœ… Updated [.env.example](file:///Users/akashyadav/Desktop/intern/backend/.env.example) - Comprehensive environment template
- âœ… Updated [.gitignore](file:///Users/akashyadav/Desktop/intern/backend/.gitignore) - Proper exclusions for production
- âœ… Enhanced [config.py](file:///Users/akashyadav/Desktop/intern/backend/app/config.py) - Added JWT_SECRET_KEY and security warnings
- âœ… Created [render.yaml](file:///Users/akashyadav/Desktop/intern/backend/render.yaml) - Render deployment configuration
- âœ… Existing [build.sh](file:///Users/akashyadav/Desktop/intern/backend/build.sh) - Build script for Render
- âœ… Existing [Procfile](file:///Users/akashyadav/Desktop/intern/backend/Procfile) - Process configuration
- âœ… Existing [requirements.txt](file:///Users/akashyadav/Desktop/intern/backend/requirements.txt) - All dependencies including Gunicorn

---

## ğŸ“ Manual Steps You Need to Do

### Step 1: Generate Secret Keys ğŸ”

**IMPORTANT:** Generate secure secret keys before deploying!

```bash
cd /Users/akashyadav/Desktop/intern/backend
python3 generate_secret_key.py
```

This will output two secure random keys:
- `SECRET_KEY` - For Flask session security
- `JWT_SECRET_KEY` - For JWT token signing

**Save these keys immediately!** You'll need them in Step 5.

---

### Step 2: Push to GitHub (if not already done)

If you haven't pushed your backend to GitHub yet:

```bash
cd /Users/akashyadav/Desktop/intern
git add .
git commit -m "Backend ready for production deployment"
git push origin main
```

If this is your first push, follow the GitHub setup from the [frontend guide](file:///Users/akashyadav/Desktop/intern/frontend/VERCEL_DEPLOYMENT.md).

---

### Step 3: Sign Up/Login to Render

1. Go to [Render](https://render.com)
2. Click **"Get Started"** or **"Sign In"**
3. Choose **"Sign in with GitHub"** 
4. Authorize Render to access your repositories

---

### Step 4: Create PostgreSQL Database

**Before deploying the web service, create the database first!**

#### 4.1 Create New PostgreSQL Instance

1. In Render Dashboard, click **"New +"** â†’ **"PostgreSQL"**
2. Fill in the details:
   - **Name**: `user-management-db`
   - **Database**: `user_management`
   - **User**: `user_management_user` (auto-generated is fine)
   - **Region**: Choose closest to you (e.g., Oregon)
   - **Plan**: **Free** (or paid for production)
3. Click **"Create Database"**

#### 4.2 Save Database Connection String

Once created, you'll see your database details:
- **Internal Database URL** - This is what you need!
- Format: `postgresql://user:password@hostname:5432/database`

**Copy the Internal Database URL** - you'll need it in the next step.

> [!IMPORTANT]
> Use the **Internal Database URL**, not the External URL. Internal URLs are faster and free within Render.

---

### Step 5: Deploy Backend Web Service

#### 5.1 Create New Web Service

1. Click **"New +"** â†’ **"Web Service"**
2. Connect your GitHub repository
3. Select your repository (`user-management-backend`)

#### 5.2 Configure Service Settings

**Basic Settings:**
- **Name**: `user-management-backend`
- **Region**: Same as your database (e.g., Oregon)
- **Branch**: `main`
- **Root Directory**: `.` (Leave empty)
- **Runtime**: **Python 3**
- **Build Command**: `./build.sh`
- **Start Command**: `gunicorn run:app`
- **Plan**: **Free** (or paid for production)

#### 5.3 Add Environment Variables

Click **"Advanced"** â†’ **"Add Environment Variable"** and add these:

| Variable Name | Value | Notes |
|--------------|-------|-------|
| `FLASK_ENV` | `production` | Sets Flask to production mode |
| `DATABASE_URL` | `[Your Internal Database URL from Step 4]` | PostgreSQL connection string |
| `SECRET_KEY` | `[Generated from generate_secret_key.py]` | Flask session security |
| `JWT_SECRET_KEY` | `[Generated from generate_secret_key.py]` | JWT token signing |
| `JWT_EXPIRATION_HOURS` | `24` | Token expiration time |
| `CORS_ORIGINS` | `https://your-frontend.vercel.app` | Your Vercel frontend URL |
| `PYTHON_VERSION` | `3.11.0` | Python version (optional) |

> [!WARNING]
> - Make sure `DATABASE_URL` is the **Internal Database URL** from your Render PostgreSQL instance
> - Use the secure keys generated by `generate_secret_key.py`, NOT the example values
> - Update `CORS_ORIGINS` with your actual Vercel frontend URL after you deploy it

#### 5.4 Deploy

1. Click **"Create Web Service"**
2. Render will start building and deploying your app
3. Watch the logs for any errors
4. Wait for deployment to complete (typically 2-5 minutes)

---

### Step 6: Create Admin User

Once deployment is successful, you need to create an admin user:

#### Option A: Using Render Shell (Recommended)

1. Go to your web service in Render Dashboard
2. Click **"Shell"** in the left sidebar
3. Run the following commands:

```bash
python create_admin.py
```

Follow the prompts to create your admin account.

#### Option B: Using Local Script with Production Database

You can also run the admin creation script locally by temporarily connecting to your production database:

```bash
# Temporarily set DATABASE_URL to your Render database
export DATABASE_URL="your-render-database-internal-url"
python create_admin.py
```

---

### Step 7: Update Frontend with Backend URL

Now that your backend is deployed:

1. Go to your Render dashboard
2. Copy your backend URL (e.g., `https://user-management-backend.onrender.com`)
3. Go to [Vercel Dashboard](https://vercel.com/dashboard)
4. Open your frontend project
5. Go to **Settings** â†’ **Environment Variables**
6. Update `VITE_API_URL` to: `https://your-backend.onrender.com/api`
7. Redeploy your frontend

---

## ğŸ”§ Important Configuration Notes

### CORS Setup

Make sure your backend's `CORS_ORIGINS` includes your Vercel frontend URL:

```
CORS_ORIGINS=https://your-frontend-name.vercel.app
```

If you have multiple frontend URLs (e.g., custom domain), separate them with commas:

```
CORS_ORIGINS=https://your-app.vercel.app,https://www.yourdomain.com
```

### Database Migrations

The `build.sh` script automatically runs `flask db upgrade` during deployment. If you need to run migrations manually:

1. Go to Render Dashboard â†’ Your Service â†’ **Shell**
2. Run: `flask db upgrade`

### Checking Logs

To view your application logs:
1. Go to Render Dashboard â†’ Your Service
2. Click **"Logs"** tab
3. Filter by severity if needed

---

## âœ… Post-Deployment Checklist

After deployment, verify:

- [ ] Backend is accessible at your Render URL
- [ ] Check logs for any errors
- [ ] Database is connected (no connection errors in logs)
- [ ] Admin user is created
- [ ] CORS is properly configured
- [ ] Test from frontend:
  - [ ] User signup works
  - [ ] User login works
  - [ ] Admin panel loads
  - [ ] Activate/deactivate user functionality works

---

## ğŸ› Common Issues and Solutions

### Issue 1: Build fails with "Permission denied" for build.sh

**Solution:** Make build.sh executable before pushing to Git:
```bash
chmod +x backend/build.sh
git add backend/build.sh
git commit -m "Make build.sh executable"
git push origin main
```

### Issue 2: Database connection errors

**Solution:** 
1. Verify you're using the **Internal Database URL**, not External
2. Check that `DATABASE_URL` environment variable is set correctly
3. Ensure your database instance is in the same region as your web service

### Issue 3: CORS errors from frontend

**Solution:**
1. Add your Vercel URL to `CORS_ORIGINS` environment variable
2. Make sure to include the full URL with `https://`
3. No trailing slash in the URL
4. Redeploy the backend after updating environment variables

### Issue 4: "SECRET_KEY not set" warnings

**Solution:**
1. Generate keys using `python generate_secret_key.py`
2. Add both `SECRET_KEY` and `JWT_SECRET_KEY` to Render environment variables
3. Redeploy

### Issue 5: 502 Bad Gateway

**Solution:**
1. Check logs for Python errors
2. Verify Gunicorn is starting correctly
3. Check that `run:app` points to the correct application object
4. Ensure all dependencies in `requirements.txt` are compatible

### Issue 6: Free tier limitations

**Note:** Render's free tier:
- Spins down after 15 minutes of inactivity
- First request after spin-down takes 30-60 seconds
- Upgrade to paid plan for production use with no downtime

---

## ğŸ”„ Updating Your Deployment

After making code changes:

```bash
git add .
git commit -m "Your commit message"
git push origin main
```

Render will automatically:
1. Detect the push
2. Run the build script
3. Deploy the new version

---

## ğŸ“Š Monitoring Your Application

### View Metrics

In Render Dashboard:
- **Metrics** tab shows CPU, Memory, and Request metrics
- **Logs** tab shows application output
- **Events** tab shows deployment history

### Set Up Alerts (Paid Plans)

Consider setting up alerts for:
- Service downtime
- High error rates
- Memory/CPU usage spikes

---

## ğŸ¯ Production Best Practices

### Security

- âœ… Use strong secret keys (generated via `generate_secret_key.py`)
- âœ… Enable HTTPS (Render provides this automatically)
- âœ… Restrict CORS to only your frontend domains
- âœ… Keep dependencies updated
- âœ… Use environment variables for all secrets

### Performance

- Consider upgrading to a paid plan for:
  - No cold starts
  - More CPU/Memory
  - Auto-scaling
- Use connection pooling for database
- Enable caching where appropriate

### Backups

Render Free tier includes:
- PostgreSQL backups (retained for 7 days)
- For paid plans: automatic daily backups

To create manual backup:
1. Go to your database in Render
2. Click **"Backups"** tab
3. Click **"Create Backup"**

---

## ğŸš€ Your Deployment URLs

After deployment, save these URLs:

- **Backend API:** `https://user-management-backend.onrender.com/api`
- **Frontend:** `https://your-frontend.vercel.app`
- **Database:** Internal URL (keep this private!)

---

## ğŸ“ Need Help?

If you encounter issues:
- Check Render's logs for detailed error messages
- Review environment variables are set correctly
- Verify database connection string
- Check CORS configuration
- Ensure all dependencies are in `requirements.txt`

---

## ğŸ‰ Next Steps

1. âœ… Deploy backend to Render
2. âœ… Create admin user
3. âœ… Update frontend with backend URL
4. âœ… Test all functionality
5. ğŸ¯ (Optional) Add custom domain
6. ğŸ¯ (Optional) Set up monitoring and alerts
7. ğŸ¯ (Optional) Upgrade to paid tier for production

Your backend is now fully prepared for deployment! ğŸš€
